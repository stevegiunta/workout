const workoutForm = document.getElementById('workoutForm');
const calendarList = document.getElementById('calendar');
const todayWorkoutDiv = document.getElementById('todayWorkout');
const exerciseInputsDiv = document.getElementById('exerciseInputs');
const workoutHistory = document.getElementById('workoutHistory');
const timerDisplay = document.getElementById('timerDisplay');
const startTimerBtn = document.getElementById('startTimer');
const pauseTimerBtn = document.getElementById('pauseTimer');
const resetTimerBtn = document.getElementById('resetTimer');

let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
let timerInterval = null;
let timerSeconds = 0;
let isTimerRunning = false;

// Workout definitions
const workoutPlans = {
  A: [
    { exercise: 'Bench Press', sets: 3 },
    { exercise: 'Squat', sets: 3 }
  ],
  B: [
    { exercise: 'Deadlift', sets: 3 },
    { exercise: 'Overhead Press', sets: 3 }
  ]
};

// Weekly schedule (0 = Sunday, 1 = Monday, ..., 6 = Saturday)
const weeklySchedule = [
  'B', // Sunday
  'A', // Monday
  'Rest', // Tuesday
  'B', // Wednesday
  'Rest', // Thursday
  'A', // Friday
  'Rest' // Saturday
];

// Load content on page load
document.addEventListener('DOMContentLoaded', () => {
  renderCalendar();
  renderTodayWorkout();
  renderHistory();
});

// Render weekly calendar
function renderCalendar() {
  calendarList.innerHTML = '';
  const today = new Date();
  const startOfWeek = new Date(today);
  startOfWeek.setDate(today.getDate() - today.getDay()); // Start on Sunday

  for (let i = 0; i < 7; i++) {
    const day = new Date(startOfWeek);
    day.setDate(startOfWeek.getDate() + i);
    const dayName = day.toLocaleDateString('en-US', { weekday: 'long' });
    const schedule = weeklySchedule[i];
    const isToday = day.toDateString() === today.toDateString();
    const li = document.createElement('li');
    li.className = isToday ? 'font-bold text-blue-600' : '';
    li.textContent = `${dayName}: ${schedule}`;
    calendarList.appendChild(li);
  }
}

// Render today's workout and form
function renderTodayWorkout() {
  const today = new Date();
  const dayIndex = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
  const schedule = weeklySchedule[dayIndex];

  if (schedule === 'Rest') {
    todayWorkoutDiv.textContent = 'Today is a rest day.';
    exerciseInputsDiv.innerHTML = '';
    workoutForm.querySelector('button').disabled = true;
    return;
  }

  const workout = workoutPlans[schedule];
  todayWorkoutDiv.innerHTML = `<strong>Workout ${schedule}</strong>:<br>${workout.map(w => `${w.exercise} (${w.sets} sets)`).join('<br>')}`;

  // Generate form inputs for each exercise
  exerciseInputsDiv.innerHTML = '';
  workout.forEach((w, index) => {
    const div = document.createElement('div');
    div.className = 'space-y-2';
    div.innerHTML = `
      <label class="block text-gray-700">${w.exercise} (${w.sets} sets)</label>
      <div class="flex space-x-2">
        <input type="number" name="reps_${index}" class="w-full p-2 border rounded" min="1" placeholder="Reps" aria-label="Reps for ${w.exercise}" required>
        <input type="number" name="weight_${index}" class="w-full p-2 border rounded" min="0" placeholder="Weight (lbs)" aria-label="Weight for ${w.exercise}" required>
      </div>
    `;
    exerciseInputsDiv.appendChild(div);
  });
  workoutForm.querySelector('button').disabled = false;
}

// Form submission
workoutForm.addEventListener('submit', (e) => {
  e.preventDefault();

  const today = new Date();
  const dayIndex = today.getDay();
  const schedule = weeklySchedule[dayIndex];

  if (schedule === 'Rest') return;

  const workout = workoutPlans[schedule];
  const loggedWorkout = {
    type: schedule,
    date: today.toLocaleString(),
    exercises: []
  };

  let valid = true;
  workout.forEach((w, index) => {
    const reps = parseInt(document.querySelector(`input[name="reps_${index}"]`).value);
    const weight = parseInt(document.querySelector(`input[name="weight_${index}"]`).value);

    if (isNaN(reps) || isNaN(weight)) {
      valid = false;
      return;
    }

    loggedWorkout.exercises.push({
      exercise: w.exercise,
      sets: w.sets,
      reps,
      weight
    });
  });

  if (!valid) {
    alert('Please fill in all fields with valid values.');
    return;
  }

  workouts.push(loggedWorkout);
  localStorage.setItem('workouts', JSON.stringify(workouts));
  renderHistory();
  workoutForm.reset();
  alert('Workout logged successfully!');
});

// Render workout history
function renderHistory() {
  workoutHistory.innerHTML = '';
  workouts.forEach((w) => {
    const li = document.createElement('li');
    li.innerHTML = `${w.date}: Workout ${w.type}<br>${w.exercises.map(e => `${e.exercise}: ${e.sets} sets, ${e.reps} reps, ${e.weight} lbs`).join('<br>')}`;
    workoutHistory.appendChild(li);
  });
}

// Timer functions
function updateTimerDisplay() {
  const minutes = Math.floor(timerSeconds / 60);
  const seconds = timerSeconds % 60;
  timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function startTimer() {
  if (!isTimerRunning) {
    isTimerRunning = true;
    startTimerBtn.disabled = true;
    pauseTimerBtn.disabled = false;
    timerInterval = setInterval(() => {
      timerSeconds++;
      updateTimerDisplay();
      if (timerSeconds === 60) {
        clearInterval(timerInterval);
        isTimerRunning = false;
        startTimerBtn.disabled = false;
        pauseTimerBtn.disabled = true;
        alert('Rest timer complete!');
      }
    }, 1000);
  }
}

function pauseTimer() {
  if (isTimerRunning) {
    clearInterval(timerInterval);
    isTimerRunning = false;
    startTimerBtn.disabled = false;
    pauseTimerBtn.disabled = true;
  }
}

function resetTimer() {
  clearInterval(timerInterval);
  isTimerRunning = false;
  timerSeconds = 0;
  updateTimerDisplay();
  startTimerBtn.disabled = false;
  pauseTimerBtn.disabled = true;
}

// Timer button events
startTimerBtn.addEventListener('click', startTimer);
pauseTimerBtn.addEventListener('click', pauseTimer);
resetTimerBtn.addEventListener('click', resetTimer);
